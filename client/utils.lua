screen = Vector(guiGetScreenSize())
cursor = { x = -1, y = -1, state = false }

scale = reMap(screen.x, 640, 1366, 0.75, 1)

if abs(screen.x / screen.y) < 1.5 then
    scale = reMap(screen.y, 480, 768, 0.75, 1)
end

local rectCache = {}
local strokeCache = {}
local textWidthCache = {}
local animCache = {}
local fontCache = {}

function resp(num)
    return floor(num * scale)
end

local _dxDrawText = dxDrawText
local _dxDrawImage = dxDrawImage
local _dxDrawImageSection = dxDrawImageSection
local _dxGetTextWidth = dxGetTextWidth

function dxDrawText(text, x, y, w, h, ...)
    return _dxDrawText(text, x, y, x + w, y + h, ...)
end

function dxDrawImage(x, y, w, h, img, col, rot, rotX, rotY, postGUI)
    return _dxDrawImage(x, y, w, h, img, rot or 0, rotX or 0, rotY or 0, col or 0xFFFFFFFF, postGUI)
end

function dxDrawImageSection(x, y, w, h, u, v, uw, vh, img, col, blend, rot, rotX, rotY, postGUI)
    return _dxDrawImageSection(x, y, w, h, u, v, uw, vh, img, rot or 0, rotX or 0, rotY or 0, col or 0xFFFFFFFF, postGUI)
end

function dxGetTextWidth(text, font)
    font = font or "default"
    local key = text .. ":" .. tostring(font)
    local width = textWidthCache[key]

    if not width then
        width = _dxGetTextWidth(text, 1, font)
        textWidthCache[key] = width
    end

    return width
end

function dxDrawRectangleRounded(x, y, w, h, col, radius, stroke)
    radius = resp(radius or 0)

    if radius == 0 then
        return dxDrawRectangle(x, y, w, h, col)
    end

    local id = ("%.1f:%.1f:%.1f"):format(w, h, radius)
    local rect = rectCache[id]

    if not rect then
        local raw = format([[
            <svg width="%.1f" height="%.1f" xmlns="http://www.w3.org/2000/svg">
                <rect x="1" y="1" width="%.1f" height="%.1f" rx="%.1f" fill="white"/>
            </svg>
        ]], w + 2, h + 2, w, h, radius)

        rect = svgCreate(w + 2, h + 2, raw)
        rectCache[id] = rect
    end

    dxDrawImage(x - 1, y - 1, w + 2, h + 2, rect, col)

    if stroke then
        local svg = strokeCache[id]

        if not svg then
            local halfStroke = resp(stroke[2] / 2)
            local raw = format([[
                <svg width="%.1f" height="%.1f" xmlns="http://www.w3.org/2000/svg">
                    <rect x="%.1f" y="%.1f" width="%.1f" height="%.1f" rx="%.1f" fill="none" stroke="white" stroke-width="%.1f"/>
                </svg>
            ]], w + 2, h + 2, 1 + halfStroke, 1 + halfStroke, w - stroke[2], h - stroke[2], radius, stroke[2])

            svg = svgCreate(w + 2, h + 2, raw)
            strokeCache[id] = svg
        end

        dxDrawImage(x - 1, y - 1, w + 2, h + 2, svg, stroke[1])
    end

    return rect
end

function rgba(r, g, b, a)
    return tocolor(r, g, b, (min(1, a or 1)) * 255)
end

function rgbaf(id, r, g, b, a, f)
    if type(r) == "table" then
        f, r, g, b, a = g, r[1], r[2], r[3], r[4] or 1
    end

    local col = animCache[id] or {r or 0, g or 0, b or 0, 0}
    animCache[id] = col

    col[1] = col[1] + (r - col[1]) * 0.2
    col[2] = col[2] + (g - col[2]) * 0.2
    col[3] = col[3] + (b - col[3]) * 0.2
    col[4] = col[4] + (a - col[4]) * 0.3

    return rgba(col[1], col[2], col[3], col[4] * (f or 1))
end

function interpolate(id, target, duration)
    duration = duration or 500
    local anim = animCache[id] or { target = target, current = 0, start = getTickCount(), duration = duration }
    animCache[id] = anim

    if anim.target ~= target then
        anim.target = target
        if (getTickCount() - anim.start) / anim.duration >= 1 then
            anim.start = getTickCount()
        end
    end

    if anim.duration ~= duration then
        anim.duration = duration
        anim.start = getTickCount()
    end

    local progress = anim.duration <= 1 and anim.duration or min((getTickCount() - anim.start) / anim.duration, 1)
    anim.current = anim.current + (anim.target - anim.current) * progress
    return anim.current
end

function getFont(font, size, ...)
    size = resp(floor(size * 0.75))
    local key = font .. ":" .. size

    if not (fontCache[key] and isElement(fontCache[key])) then
        fontCache[key] = dxCreateFont("assets/fonts/" .. font .. ".ttf", size, ...)
    end

    return fontCache[key]
end

function updateCursor()
    cursor.state = isCursorShowing()

    if cursor.state then
        local x, y = getCursorPosition()
        cursor.x, cursor.y = x * screen.x, y * screen.y
    else
        cursor.x, cursor.y = -1, -1
    end
end

function isCursorOver(x, y, w, h)
    return cursor.state and cursor.x >= x and cursor.x <= x + w and cursor.y >= y and cursor.y <= y + h
end

icon = {}

for i, v in pairs({
    main = [[
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M7.21191 2.39981H8.78532C8.83745 2.39981 8.88744 2.41948 8.9243 2.45448C8.96117 2.48948 8.98187 2.53695 8.98187 2.58646C8.98187 4.2737 10.9061 5.32916 12.4451 4.4846C12.4901 4.46048 12.5432 4.45411 12.593 4.46686C12.6428 4.4796 12.6854 4.51045 12.7115 4.55273L13.4996 5.84802C13.5254 5.89076 13.5322 5.94142 13.5188 5.98896C13.5054 6.0365 13.4727 6.07708 13.4279 6.10185C11.8889 6.94547 11.8889 9.05453 13.4279 9.89908C13.4724 9.92385 13.5049 9.96426 13.5183 10.0116C13.5318 10.0589 13.525 10.1093 13.4996 10.152L12.7115 11.4473C12.6854 11.4896 12.6428 11.5204 12.593 11.5331C12.5432 11.5459 12.4901 11.5395 12.4451 11.5154C10.9061 10.6708 8.98187 11.7254 8.98187 13.4117C8.98187 13.461 8.9613 13.5084 8.92465 13.5433C8.888 13.5783 8.83826 13.5981 8.7863 13.5983H7.2129C7.16077 13.5983 7.11077 13.5787 7.07391 13.5437C7.03705 13.5087 7.01634 13.4612 7.01634 13.4117C7.01634 11.7244 5.09209 10.6699 3.55308 11.5135C3.50807 11.5379 3.45472 11.5445 3.40465 11.5317C3.35459 11.519 3.31186 11.4879 3.28577 11.4454L2.49955 10.1501C2.47407 10.1076 2.46721 10.0572 2.48044 10.0099C2.49368 9.96261 2.52595 9.92214 2.57031 9.89721C4.10932 9.05266 4.10932 6.94361 2.57031 6.09905C2.52605 6.07429 2.49375 6.03405 2.48035 5.98696C2.46694 5.93986 2.47348 5.88966 2.49857 5.84709L3.28577 4.55086C3.31202 4.50849 3.35482 4.47766 3.40488 4.46508C3.45493 4.4525 3.50818 4.45918 3.55308 4.48367C5.09209 5.32822 7.01634 4.27276 7.01634 2.58552C7.01634 2.48287 7.10381 2.39981 7.21191 2.39981ZM5.54219 2.58646C5.54219 1.70924 6.2891 1 7.21191 1H8.78532C9.70912 1 10.456 1.70924 10.456 2.58646C10.4563 2.72547 10.4951 2.86197 10.5684 2.98228C10.6418 3.10259 10.7471 3.20248 10.8739 3.27195C11.0007 3.34142 11.1445 3.37803 11.2909 3.3781C11.4373 3.37817 11.5812 3.34171 11.7081 3.27236C12.0916 3.06263 12.547 3.00596 12.9745 3.11478C13.402 3.22361 13.7665 3.48904 13.9881 3.85282L14.7763 5.14811C15.2372 5.90681 14.963 6.87548 14.165 7.31316C14.038 7.38279 13.9326 7.48292 13.8594 7.60348C13.7861 7.72405 13.7475 7.8608 13.7475 8C13.7475 8.1392 13.7861 8.27595 13.8594 8.39652C13.9326 8.51708 14.038 8.61721 14.165 8.68684C14.5481 8.89725 14.8276 9.2434 14.9422 9.64931C15.0568 10.0552 14.9971 10.4877 14.7763 10.8519L13.9881 12.1472C13.7665 12.511 13.402 12.7764 12.9745 12.8852C12.547 12.994 12.0916 12.9374 11.7081 12.7276C11.5812 12.6583 11.4373 12.6218 11.2909 12.6219C11.1445 12.622 11.0007 12.6586 10.8739 12.728C10.7471 12.7975 10.6418 12.8974 10.5684 13.0177C10.4951 13.138 10.4563 13.2745 10.456 13.4135C10.456 14.2898 9.70912 15 8.7863 15H7.2129C6.76997 14.9998 6.34527 14.8325 6.03217 14.535C5.71906 14.2375 5.54318 13.8341 5.54318 13.4135C5.54289 13.2745 5.50412 13.138 5.43078 13.0177C5.35743 12.8974 5.25208 12.7975 5.12527 12.728C4.99846 12.6586 4.85466 12.622 4.70826 12.6219C4.56186 12.6218 4.41802 12.6583 4.29114 12.7276C3.90763 12.9374 3.45216 12.994 3.02469 12.8852C2.59723 12.7764 2.2327 12.511 2.01112 12.1472L1.22294 10.8519C1.00207 10.4877 0.94239 10.0552 1.05699 9.64931C1.1716 9.2434 1.45113 8.89725 1.83422 8.68684C1.96092 8.61714 2.06611 8.51705 2.13923 8.39658C2.21235 8.27611 2.25084 8.13951 2.25084 8.00047C2.25084 7.86142 2.21235 7.72482 2.13923 7.60435C2.06611 7.48389 1.96092 7.38379 1.83422 7.31409C1.45113 7.10368 1.1716 6.75754 1.05699 6.35163C0.94239 5.94572 1.00207 5.51321 1.22294 5.14905L2.01014 3.85282C2.23172 3.48904 2.59625 3.22361 3.02371 3.11478C3.45117 3.00596 3.90665 3.06263 4.29015 3.27236C4.41703 3.34171 4.56088 3.37817 4.70728 3.3781C4.85368 3.37803 4.99748 3.34142 5.12429 3.27195C5.2511 3.20248 5.35645 3.10259 5.4298 2.98228C5.50314 2.86197 5.5419 2.72547 5.54219 2.58646ZM9.47326 7.99907C9.47326 8.37032 9.31794 8.72637 9.04149 8.98888C8.76503 9.2514 8.39008 9.39888 7.99911 9.39888C7.60814 9.39888 7.23318 9.2514 6.95673 8.98888C6.68027 8.72637 6.52496 8.37032 6.52496 7.99907C6.52496 7.62781 6.68027 7.27177 6.95673 7.00925C7.23318 6.74673 7.60814 6.59925 7.99911 6.59925C8.39008 6.59925 8.76503 6.74673 9.04149 7.00925C9.31794 7.27177 9.47326 7.62781 9.47326 7.99907ZM10.9474 7.99907C10.9474 8.74157 10.6368 9.45367 10.0839 9.9787C9.53096 10.5037 8.78104 10.7987 7.99911 10.7987C7.21717 10.7987 6.46726 10.5037 5.91435 9.9787C5.36144 9.45367 5.05081 8.74157 5.05081 7.99907C5.05081 7.25656 5.36144 6.54446 5.91435 6.01943C6.46726 5.4944 7.21717 5.19944 7.99911 5.19944C8.78104 5.19944 9.53096 5.4944 10.0839 6.01943C10.6368 6.54446 10.9474 7.25656 10.9474 7.99907Z" fill="white"/>
        </svg>
    ]],

    search = [[
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12.8024 11.8597L10.1672 9.22343C10.9573 8.19384 11.3262 6.90225 11.199 5.61068C11.0718 4.31911 10.4581 3.12428 9.48232 2.26855C8.50654 1.41282 7.24178 0.960286 5.9446 1.00274C4.64742 1.04519 3.41495 1.57945 2.49721 2.49714C1.57948 3.41484 1.04519 4.64725 1.00274 5.94437C0.960284 7.24149 1.41284 8.50619 2.26861 9.48192C3.12437 10.4577 4.31927 11.0714 5.6109 11.1985C6.90252 11.3257 8.19417 10.9568 9.22381 10.1667L11.8613 12.8046C11.9232 12.8666 11.9968 12.9157 12.0777 12.9492C12.1586 12.9827 12.2454 13 12.333 13C12.4206 13 12.5073 12.9827 12.5882 12.9492C12.6692 12.9157 12.7427 12.8666 12.8046 12.8046C12.8666 12.7427 12.9157 12.6692 12.9492 12.5882C12.9827 12.5073 13 12.4206 13 12.333C13 12.2454 12.9827 12.1587 12.9492 12.0777C12.9157 11.9968 12.8666 11.9233 12.8046 11.8613L12.8024 11.8597ZM2.34297 6.1161C2.34297 5.36983 2.56428 4.64033 2.9789 4.01983C3.39352 3.39933 3.98284 2.91571 4.67233 2.63013C5.36183 2.34454 6.12052 2.26982 6.85248 2.41541C7.58445 2.561 8.2568 2.92036 8.78451 3.44805C9.31222 3.97574 9.6716 4.64806 9.8172 5.37999C9.96279 6.11191 9.88807 6.87058 9.60247 7.56004C9.31688 8.2495 8.83323 8.83879 8.21271 9.25339C7.59218 9.668 6.86264 9.88929 6.11634 9.88929C5.11589 9.88826 4.15672 9.4904 3.4493 8.78301C2.74188 8.07563 2.344 7.1165 2.34297 6.1161Z" fill="white"/>
        </svg>
    ]],

    mananger = [[
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.3684 3.22222H11.4737M8.94737 2V4.44444M8.94737 3.22222H2M4.52632 7.5H2M7.05263 6.27778V8.72222M14 7.5H7.05263M13.3684 11.7778H11.4737M8.94737 10.5556V13M8.94737 11.7778H2" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    ]],

    check = [[
        <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3.62579 7.57083L1 4.94503L2.19662 3.74841L3.62579 5.18182L7.80338 1L9 2.19662L3.62579 7.57083Z" fill="white"/>
        </svg>
    ]],

    close = [[
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.3751 1.62502C10.0299 1.27983 9.47027 1.27979 9.12507 1.62494L5.99956 4.75L2.87489 1.62505C2.52972 1.27986 1.97006 1.27986 1.62489 1.62506C1.27976 1.97021 1.27976 2.52979 1.62489 2.87494L4.74967 6L1.62489 9.12506C1.27976 9.47021 1.27976 10.0298 1.62489 10.3749C1.97006 10.7201 2.52972 10.7201 2.87489 10.3749L5.99956 7.25L9.12507 10.3751C9.47027 10.7202 10.0299 10.7202 10.3751 10.375C10.7202 10.0298 10.7202 9.4702 10.3751 9.12502L7.25033 6L10.3751 2.87498C10.7202 2.5298 10.7202 1.97019 10.3751 1.62502Z" fill="white"/>
        </svg>
    ]],

    arrow = [[
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.8472 6.10478L13.9988 5.90714C14.0692 5.96121 14.1294 6.02872 14.173 6.10764L13.9541 6.2284L14.173 6.10764C14.2167 6.18684 14.2421 6.27497 14.2453 6.3666C14.2485 6.45828 14.2292 6.5481 14.1906 6.63022C14.1522 6.71205 14.096 6.78318 14.0285 6.84116L10.5136 9.86149L14.0274 12.8816C14.0956 12.9389 14.1526 13.0095 14.1921 13.091C14.2319 13.1734 14.2523 13.2637 14.2498 13.3562C14.2473 13.4487 14.2222 13.5378 14.1784 13.6178C14.1347 13.6976 14.0741 13.7658 14.003 13.8203C13.9319 13.8748 13.8508 13.9153 13.7653 13.9415L13.6921 13.7024L13.7653 13.9415C13.6797 13.9677 13.5897 13.9795 13.5002 13.9769C13.4106 13.9743 13.3214 13.9573 13.2377 13.926C13.1545 13.8949 13.0767 13.8497 13.0098 13.791L8.9672 10.3164L8.96709 10.3163L9.13004 10.1267C9.04653 10.055 9 9.96013 9 9.86147C9 9.7628 9.04653 9.66788 9.13004 9.59619L13.8472 6.10478ZM13.8472 6.10478L13.9988 5.90714C13.9283 5.85311 13.848 5.81278 13.7633 5.78655C13.6786 5.76031 13.5894 5.74818 13.5006 5.75022C13.4117 5.75226 13.3233 5.76847 13.2399 5.79876C13.1566 5.82904 13.0784 5.8734 13.011 5.93131L13.011 5.93135L8.9672 9.4065L13.8472 6.10478Z" fill="white" stroke="white" stroke-width="0.5"/>
        </svg>
    ]]
}) do
    icon[i] = svgCreate(v:match('width="(%d+)"'), v:match('height="(%d+)"'), v)
end